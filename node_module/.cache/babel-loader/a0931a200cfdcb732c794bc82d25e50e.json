{"ast":null,"code":"import { parseDataUrlContent } from './util';\nvar cache = {};\n\nfunction getCacheKey(url) {\n  var key = url.replace(/\\?.*/, ''); // font resourse\n\n  if (/ttf|otf|eot|woff2?/i.test(key)) {\n    key = key.replace(/.*\\//, '');\n  }\n\n  return key;\n}\n\nexport function getBlobFromURL(url, options) {\n  var cacheKey = getCacheKey(url);\n\n  if (cache[cacheKey] != null) {\n    return cache[cacheKey];\n  } // cache bypass so we dont have CORS issues with cached images\n  // ref: https://developer.mozilla.org/en/docs/Web/API/XMLHttpRequest/Using_XMLHttpRequest#Bypassing_the_cache\n\n\n  if (options.cacheBust) {\n    // eslint-disable-next-line no-param-reassign\n    url += (/\\?/.test(url) ? '&' : '?') + new Date().getTime();\n  }\n\n  var failed = function failed(reason) {\n    var placeholder = '';\n\n    if (options.imagePlaceholder) {\n      var parts = options.imagePlaceholder.split(/,/);\n\n      if (parts && parts[1]) {\n        placeholder = parts[1];\n      }\n    }\n\n    var msg = \"Failed to fetch resource: \".concat(url);\n\n    if (reason) {\n      msg = typeof reason === 'string' ? reason : reason.message;\n    }\n\n    if (msg) {\n      console.error(msg);\n    }\n\n    return {\n      blob: placeholder,\n      contentType: ''\n    };\n  };\n\n  var deferred = window.fetch(url).then(function (res) {\n    return (// eslint-disable-next-line promise/no-nesting\n      res.blob().then(function (blob) {\n        return {\n          blob: blob,\n          contentType: res.headers.get('Content-Type') || ''\n        };\n      })\n    );\n  }).then(function (_ref) {\n    var blob = _ref.blob,\n        contentType = _ref.contentType;\n    return new Promise(function (resolve, reject) {\n      var reader = new FileReader();\n\n      reader.onloadend = function () {\n        return resolve({\n          contentType: contentType,\n          blob: reader.result\n        });\n      };\n\n      reader.onerror = reject;\n      reader.readAsDataURL(blob);\n    });\n  }).then(function (_ref2) {\n    var blob = _ref2.blob,\n        contentType = _ref2.contentType;\n    return {\n      contentType: contentType,\n      blob: parseDataUrlContent(blob)\n    };\n  }) // on failed\n  .catch(failed); // cache result\n\n  cache[cacheKey] = deferred;\n  return deferred;\n}","map":{"version":3,"mappings":"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","names":["parseDataUrlContent","cache","getCacheKey","url","key","replace","test","getBlobFromURL","options","cacheKey","cacheBust","Date","getTime","failed","reason","placeholder","imagePlaceholder","parts","split","msg","message","console","error","blob","contentType","deferred","window","fetch","then","res","headers","get","Promise","resolve","reject","reader","FileReader","onloadend","result","onerror","readAsDataURL","catch"],"sources":["../src/getBlobFromURL.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}